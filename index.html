<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Wi-Fi & Shop Info Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; background: #f0f2f5; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h1 { text-align: center; color: #2c3e50; font-size: 1.6rem; margin: 0; }
        .btn-share { display: flex; align-items: center; gap: 5px; background: #fff; border: 1px solid #ddd; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; color: #555; transition: 0.2s; }
        .btn-share:hover { background: #f9f9f9; border-color: #ccc; }

        h2 { font-size: 1.1rem; border-left: 5px solid #667eea; padding-left: 10px; margin-top: 30px; color: #444; background: #f9f9f9; padding: 10px; border-radius: 0 5px 5px 0; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        input[type="text"], input[type="url"], input[type="time"], select, input[type="file"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 15px; box-sizing: border-box; }
        
        .time-row { display: flex; gap: 10px; }
        .time-col { flex: 1; }
        
        .btn-generate { width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer; margin-top: 30px; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-generate:hover { opacity: 0.95; transform: translateY(-1px); }
        .btn-generate:disabled { background: #ccc; cursor: not-allowed; }

        .btn-ai { background: #e8f0fe; color: #1a73e8; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.9rem; margin-top: 5px; width: 100%; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-ai:hover { background: #d2e3fc; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
        @media (max-width: 800px) { .grid { grid-template-columns: 1fr; } }

        .panel { padding: 0 5px; }
        
        .preview-area { display: flex; flex-direction: column; gap: 20px; align-items: center; background: #fafafa; padding: 20px; border-radius: 10px; border: 1px solid #eee; }
        .pop-card { background: white; border: 1px solid #ddd; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); width: 260px; position: relative; border-radius: 8px; }
        .pop-card.premium { border: 2px solid #d4af37; background: #fffdf5; }
        .premium-badge { position: absolute; top: 0; right: 0; background: #d4af37; color: white; font-size: 10px; padding: 4px 10px; font-weight: bold; border-bottom-left-radius: 8px; }
        
        .card-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; }
        .card-desc { font-size: 0.85rem; color: #666; margin-bottom: 10px; word-break: break-all; }
        .qr-box { margin: 15px auto; display: flex; justify-content: center; background: white; padding: 10px; border-radius: 5px; }
        .card-footer { font-size: 0.7rem; color: #999; margin-top: 10px; border-top: 1px dashed #ccc; padding-top: 5px; }
        
        .password-display { font-family: monospace; font-size: 1.2rem; background: #333; color: #0f0; padding: 10px; text-align: center; border-radius: 4px; word-break: break-all; margin: 15px 0; }
        .ai-conditions { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e8f0fe; }

        /* ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ */
        #imagePreview { margin-top: 10px; max-width: 100%; height: auto; border-radius: 8px; display: none; border: 2px dashed #ddd; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Quantum Wi-Fi & Info <span style="font-size:0.6em; color:#888;">Ver 0.5</span></h1>
        <button class="btn-share" onclick="shareApp()">
            <span class="material-icons-round" style="font-size:18px;">share</span> å…±æœ‰
        </button>
    </div>

    <div class="grid">
        <div class="panel">
            <h2>1. åº—èˆ—ãƒ»æ–½è¨­æƒ…å ± (HPç”¨)</h2>
            
            <div class="input-group" style="background:#f9f9f9; padding:15px; border-radius:8px;">
                <label><span class="material-icons-round" style="font-size:16px; vertical-align:text-bottom;">image</span> åº—èˆ—ç”»åƒ (ä»»æ„ãƒ»1æšã®ã¿)</label>
                <input type="file" id="shopImage" accept="image/*" onchange="previewImage(this)">
                <img id="imagePreview" src="" alt="Image Preview">
                <p style="font-size:0.8rem; color:#888; margin:5px 0 0;">â€»QRã‚³ãƒ¼ãƒ‰ã«åŸ‹ã‚è¾¼ã‚€ãŸã‚ã€è‡ªå‹•çš„ã«ç¸®å°ã•ã‚Œã¾ã™ã€‚</p>
            </div>

            <div class="input-group">
                <label>åº—èˆ—å / æ–½è¨­å</label>
                <input type="text" id="shopName" placeholder="ä¾‹ï¼šCafe Gemini" oninput="updatePreview()">
            </div>
            
            <div class="input-group">
                <label>ä½æ‰€ (åœ°å›³ãƒœã‚¿ãƒ³ã‚’è‡ªå‹•ä½œæˆ)</label>
                <input type="text" id="address" placeholder="ä¾‹ï¼šæ±äº¬éƒ½æ¸‹è°·åŒº...">
            </div>

            <div class="input-group">
                <label>å–¶æ¥­æ™‚é–“</label>
                <div class="time-row">
                    <div class="time-col"><span style="font-size:0.8rem; color:#666;">é–‹å§‹</span><input type="time" id="openTime"></div>
                    <div class="time-col"><span style="font-size:0.8rem; color:#666;">çµ‚äº†</span><input type="time" id="closeTime"></div>
                </div>
            </div>
            <div class="input-group">
                <label>ãƒ©ã‚¹ãƒˆã‚ªãƒ¼ãƒ€ãƒ¼ (ä»»æ„)</label>
                <input type="time" id="loTime">
            </div>

            <h2>2. Wi-Fi SSID è¨­å®š</h2>
            <div class="ai-conditions">
                <label style="color:#1a73e8; display:flex; align-items:center; gap:5px;"><span class="material-icons-round">auto_awesome</span> AI å‘½åã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (æœ‰æ–™æ©Ÿèƒ½)</label>
                <div class="time-row" style="margin-top:10px;">
                    <div class="time-col">
                        <select id="category">
                            <option value="cafe">â˜• ã‚«ãƒ•ã‚§</option>
                            <option value="office">ğŸ¢ ã‚ªãƒ•ã‚£ã‚¹</option>
                            <option value="guest">ğŸ  æ°‘æ³Šãƒ»æ–½è¨­</option>
                            <option value="event">ğŸ‰ ã‚¤ãƒ™ãƒ³ãƒˆ</option>
                        </select>
                    </div>
                    <div class="time-col">
                        <select id="style">
                            <option value="simple">ã‚·ãƒ³ãƒ—ãƒ«</option>
                            <option value="stylish">ãŠã—ã‚ƒã‚Œ</option>
                            <option value="friendly">è¦ªã—ã¿</option>
                            <option value="security">å …å®Ÿãƒ»å®‰å…¨</option>
                        </select>
                    </div>
                </div>
                <button class="btn-ai" onclick="autoGenerateSSID()">AIã§SSIDã‚’ææ¡ˆã™ã‚‹</button>
            </div>
            <div class="input-group">
                <label>SSIDï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åï¼‰</label>
                <input type="text" id="ssid" placeholder="ä¸Šã®ãƒœã‚¿ãƒ³ã§ææ¡ˆã‹ã€æ‰‹å‹•å…¥åŠ›">
            </div>
        </div>

        <div class="panel preview-area">
            <div class="pop-card">
                <div class="card-title">Free Wi-Fi</div>
                <div class="card-desc" id="wifiSsidPreview">SSID: ---</div>
                <div id="qrcode-wifi" class="qr-box"></div>
                <div style="font-size:0.8rem;">Pass: <span id="wifiPassPreview" style="font-weight:bold; background:#eee; padding:2px 5px; border-radius:3px;">---</span></div>
            </div>
            <div class="pop-card premium">
                <div class="premium-badge">PRO Info Card</div>
                <div class="card-title" id="shopNamePreview">SHOP NAME</div>
                <div class="card-desc" style="font-size:0.8rem;">å†™çœŸã€åœ°å›³ã€ãŠåº—ã®æƒ…å ±ã‚’<br>ã‚¹ãƒãƒ›ã§è¡¨ç¤º</div>
                <div id="qrcode-info" class="qr-box"></div>
                <div class="card-footer">Photo, Map & Info generated</div>
            </div>
        </div>
    </div>

    <button class="btn-generate" onclick="generateAll()">
        <span class="material-icons-round">qr_code_2</span> é‡å­ä¹±æ•°ã§ã‚­ãƒ¼ç”Ÿæˆ & ã‚«ãƒ¼ãƒ‰ä½œæˆ
    </button>
    
    <div id="result-area" style="margin-top:30px; display:none; text-align:center; background:#f9f9f9; padding:20px; border-radius:10px;">
        <h3 style="margin:0; color:#2c3e50;">ğŸ‰ è¨­å®šç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (WPA2/3)</h3>
        <p style="font-size:0.9rem; color:#666;">ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’Wi-Fiãƒ«ãƒ¼ã‚¿ãƒ¼ã«è¨­å®šã—ã¦ãã ã•ã„</p>
        <div id="generatedPass" class="password-display">---</div>
        <button onclick="copyPass()" style="padding:10px 25px; cursor:pointer; background:#333; color:white; border:none; border-radius:50px; font-weight:bold; display:inline-flex; align-items:center; gap:5px;">
            <span class="material-icons-round" style="font-size:18px;">content_copy</span> ã‚³ãƒ”ãƒ¼
        </button>
    </div>
</div>

<script>
    let compressedImage = ""; // ç¸®å°ã•ã‚ŒãŸç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ

    // ç”»åƒé¸æŠæ™‚ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ç¸®å°å‡¦ç†ã‚’è¡Œã†
    function previewImage(input) {
        const preview = document.getElementById('imagePreview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                // ç”»åƒã‚’ç¸®å°ã™ã‚‹å‡¦ç†ï¼ˆCanvasã‚’ä½¿ç”¨ï¼‰
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    // æœ€å¤§å¹…ã‚’300pxã«åˆ¶é™ï¼ˆQRã‚³ãƒ¼ãƒ‰ã®å®¹é‡å¯¾ç­–ï¼‰
                    const maxWidth = 300; 
                    const scale = maxWidth / img.width;
                    canvas.width = maxWidth;
                    canvas.height = img.height * scale;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    // JPEGå½¢å¼ã§åœ§ç¸®ç‡ã‚’ä¸‹ã’ã¦Base64åŒ–
                    compressedImage = canvas.toDataURL('image/jpeg', 0.6);
                    
                    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
                    preview.src = compressedImage;
                    preview.style.display = 'block';
                };
                img.src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.src = "";
            preview.style.display = 'none';
            compressedImage = "";
        }
    }

    function shareApp() {
        const shareData = {
            title: 'Quantum Wi-Fi Generator',
            text: 'é‡å­ä¹±æ•°ã§å®‰å…¨ãªWi-Fiãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã€å†™çœŸå…¥ã‚Šåº—èˆ—æƒ…å ±QRã‚’ä¸€ç¬ã§ä½œæˆï¼',
            url: window.location.href
        };
        if (navigator.share) {
            navigator.share(shareData).catch((err) => console.log('Share canceled', err));
        } else {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert("ã‚¢ãƒ—ãƒªã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            });
        }
    }

    function updatePreview() {
        const name = document.getElementById('shopName').value || "SHOP NAME";
        document.getElementById('shopNamePreview').textContent = name;
    }

    function autoGenerateSSID() {
        const name = document.getElementById('shopName').value.trim() || "Spot";
        const cleanName = name.replace(/\s+/g, '').replace(/[^a-zA-Z0-9]/g, ''); 
        const category = document.getElementById('category').value;
        const style = document.getElementById('style').value;
        let newSSID = "";
        if (style === 'simple') newSSID = `${cleanName}_WiFi`;
        else if (style === 'stylish') newSSID = `${cleanName}.Connect`;
        else if (style === 'friendly') newSSID = `Welcome_to_${cleanName}`;
        else if (style === 'security') newSSID = `${cleanName}_Secured_${Math.floor(Math.random()*99):02d}`;
        if (category === 'guest' && style !== 'friendly') newSSID += "_Guest";
        if (category === 'office' && style === 'simple') newSSID = `${cleanName}_Office`;
        if (category === 'event') newSSID = `${cleanName}_Event_Free`;
        document.getElementById('ssid').value = newSSID;
        const ssidBox = document.getElementById('ssid');
        ssidBox.style.backgroundColor = "#e8f0fe";
        setTimeout(() => { ssidBox.style.backgroundColor = "white"; }, 500);
    }

    async function generateAll() {
        const btn = document.querySelector('.btn-generate');
        const ssid = document.getElementById('ssid').value || "My-WiFi";
        btn.disabled = true;
        btn.innerHTML = '<span class="material-icons-round spinning">sync</span> é‡å­ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...';

        try {
            const response = await fetch('https://qrng.anu.edu.au/API/jsonI.php?length=16&type=uint8');
            const data = await response.json();
            const password = generatePasswordFromQuantum(data.data);

            const wifiString = `WIFI:S:${ssid};T:WPA;P:${password};;`;
            document.getElementById("qrcode-wifi").innerHTML = "";
            new QRCode(document.getElementById("qrcode-wifi"), {
                text: wifiString, width: 120, height: 120
            });
            
            document.getElementById('wifiSsidPreview').textContent = "SSID: " + ssid;
            document.getElementById('wifiPassPreview').textContent = password;
            document.getElementById('generatedPass').textContent = password;
            document.getElementById('result-area').style.display = 'block';

            // åº—èˆ—æƒ…å ±QRç”Ÿæˆï¼ˆå†™çœŸå¯¾å¿œï¼‰
            generateShopInfoQR();

            btn.innerHTML = '<span class="material-icons-round">qr_code_2</span> å†ç”Ÿæˆã™ã‚‹';
            btn.disabled = false;
            document.getElementById('result-area').scrollIntoView({behavior: "smooth"});

        } catch (e) {
            console.error(e);
            alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
            btn.disabled = false;
        }
    }

    function generateShopInfoQR() {
        const name = document.getElementById('shopName').value || "åº—èˆ—æƒ…å ±";
        const address = document.getElementById('address').value || "";
        const open = document.getElementById('openTime').value;
        const close = document.getElementById('closeTime').value;
        const lo = document.getElementById('loTime').value;
        
        let hoursText = "æœªè¨­å®š";
        if(open && close) {
            hoursText = `${open} ï½ ${close}`;
            if(lo) hoursText += ` (L.O. ${lo})`;
        }

        let mapBtnHtml = "";
        if (address) {
            const mapQuery = encodeURIComponent(address);
            const mapUrl = `https://www.google.com/maps/search/?api=1&query=${mapQuery}`;
            mapBtnHtml = `<a href="${mapUrl}" class="btn-map" target="_blank"><span class="material-icons-round">place</span> Googleãƒãƒƒãƒ—ã§é–‹ã</a>`;
        }

        // ç”»åƒHTMLã®ç”Ÿæˆ
        let imageHtml = "";
        if (compressedImage) {
            imageHtml = `<img src="${compressedImage}" style="width:100%; max-width:350px; border-radius:15px; margin-bottom:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1);">`;
        }

        const htmlContent = `
            <!DOCTYPE html>
            <html lang="ja">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${name}</title>
                <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
                <style>
                    body { font-family: "Helvetica Neue", Arial, sans-serif; padding: 20px; background: #f4f7f6; color:#333; line-height: 1.6; margin:0; display:flex; justify-content:center; align-items:center; min-height:100vh; }
                    .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; box-sizing: border-box; text-align:center; }
                    h1 { margin: 0 0 20px; color: #2c3e50; font-size: 1.8rem; }
                    .info-group { text-align: left; margin-bottom: 20px; background: #fcfcfc; padding: 15px; border-radius: 10px; border: 1px solid #eee; }
                    .label { font-size: 0.8rem; color: #888; display: flex; align-items: center; gap: 5px; margin-bottom: 5px; font-weight: bold; }
                    .val { font-size: 1.1rem; font-weight: 500; padding-left: 2px; word-break: break-all; }
                    .btn-map { display: inline-flex; align-items: center; justify-content: center; gap: 8px; background: #4285f4; color: white; padding: 15px 30px; text-decoration: none; border-radius: 50px; margin-top: 10px; font-weight: bold; box-shadow: 0 4px 10px rgba(66, 133, 244, 0.3); width: 80%; transition:0.2s; }
                    .btn-map:hover { background: #3374de; transform: translateY(-2px); }
                    .footer { margin-top:30px; font-size:0.7rem; color:#aaa; }
                </style>
            </head>
            <body>
                <div class="card">
                    ${imageHtml} <h1>${name}</h1>
                    <div class="info-group"><span class="label"><span class="material-icons-round" style="font-size:16px;">location_on</span> ä½æ‰€ãƒ»ã‚¢ã‚¯ã‚»ã‚¹</span><div class="val">${address || "---"}</div></div>
                    <div class="info-group"><span class="label"><span class="material-icons-round" style="font-size:16px;">schedule</span> å–¶æ¥­æ™‚é–“</span><div class="val">${hoursText}</div></div>
                    ${mapBtnHtml}
                    <div class="footer">Powered by Quantum Info Card</div>
                </div>
            </body>
            </html>
        `;

        const dataUrl = "data:text/html;charset=utf-8," + encodeURIComponent(htmlContent);

        document.getElementById("qrcode-info").innerHTML = "";
        // ç”»åƒã‚’å…¥ã‚Œã‚‹ã¨ãƒ‡ãƒ¼ã‚¿é‡ãŒå¢—ãˆã‚‹ã®ã§ã€èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«ã‚’ä¸‹ã’ã¦ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹
        new QRCode(document.getElementById("qrcode-info"), {
            text: dataUrl, width: 140, height: 140, // QRã‚’å°‘ã—å¤§ããã™ã‚‹
            colorDark : "#d4af37", colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.L // ãƒ¬ãƒ™ãƒ«ã‚’Mã‹ã‚‰Lã¸ï¼ˆå®¹é‡ç¢ºä¿ã®ãŸã‚ï¼‰
        });
    }

    function generatePasswordFromQuantum(numbers) {
        const chars = "abcdefghijkmnpqrstuvwxyz23456789ABCDEFGHJKLMNPQRSTUVWXYZ"; 
        let pass = "";
        for (let i = 0; i < numbers.length; i++) {
            pass += chars[numbers[i] % chars.length];
        }
        return pass.substring(0, 12);
    }
    
    function copyPass() {
        navigator.clipboard.writeText(document.getElementById('generatedPass').textContent);
        alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    }
</script>
</body>
</html>
