<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>One Page Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/000000/wifi-router.png">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <style>
        :root { --gold: #d4af37; --dark: #333; }
        body { font-family: -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { width: 100%; max-width: 450px; background: white; border-radius: 20px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); box-sizing: border-box; margin-bottom: 20px; }
        h1 { text-align: center; margin: 0 0 20px; font-size: 1.5rem; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin: 10px 0 5px; color: #666; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
        .btn { width: 100%; padding: 15px; border-radius: 50px; border: none; font-weight: bold; font-size: 1rem; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: white; }
        .btn-blue { background: #4285f4; color: white; margin-top: 10px; }
        .sns-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; }
        .sns-btn { padding: 10px; border-radius: 10px; color: white; text-decoration: none; font-size: 0.7rem; text-align: center; font-weight: bold; }
        #viewer-mode, #result-area { display: none; }
        .wifi-box { background: #2c3e50; color: white; border-radius: 15px; padding: 20px; text-align: center; margin: 15px 0; }
        .qr-out { margin-top: 20px; text-align: center; }
        .router-support { background: #f8f9fa; border: 1px solid #eee; padding: 15px; border-radius: 15px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="card" id="creator-mode">
    <h1>One Page Pro</h1>
    
    <div id="auth-section" style="background:#333; color:white; padding:15px; border-radius:12px; text-align:center; margin-bottom:20px;">
        <div id="my-uid" style="font-size:0.6rem; opacity:0.6; margin-bottom:5px;">Connecting...</div>
        <input type="text" id="license-input" placeholder="ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ¼" style="width:60%; margin-bottom:0;">
        <button onclick="activateLicense()" style="background:var(--gold); border:none; color:white; padding:8px 15px; border-radius:5px; font-weight:bold;">èªè¨¼</button>
    </div>

    <label>åº—èˆ—å</label>
    <input type="text" id="in-name" placeholder="Cafe One Page">
    <label>ä½æ‰€ï¼ˆGoogleMapç”¨ï¼‰</label>
    <input type="text" id="in-address" placeholder="å¾³å³¶çœŒ...">
    <label>Instagram ID / LINEå…¬å¼ ID</label>
    <div style="display:flex; gap:5px;">
        <input type="text" id="in-insta" placeholder="Insta ID">
        <input type="text" id="in-line" placeholder="LINE ID (@...)">
    </div>
    <label>ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼ URL</label>
    <input type="url" id="in-hp" placeholder="https://...">
    <label>Wi-Fiå (SSID)</label>
    <input type="text" id="in-ssid" placeholder="Shop-WiFi">

    <button onclick="startGeneration()" class="btn btn-gold">
        <span class="material-icons-round">auto_awesome</span> ãƒšãƒ¼ã‚¸ã‚’ä½œæˆ
    </button>

    <div id="result-area">
        <div class="qr-out" id="qrcode"></div>
        <div class="router-support">
            <label>ğŸ”§ ãƒ«ãƒ¼ã‚¿ãƒ¼è¨­å®šã‚µãƒãƒ¼ãƒˆ</label>
            <select id="router-select" onchange="updateRouterLink()">
                <option value="">æ©Ÿç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„...</option>
                <option value="http://192.168.128.1">docomo Home 5G</option>
                <option value="http://192.168.0.1">Rakuten Turbo</option>
                <option value="http://172.16.255.254">SoftBank Air</option>
                <option value="http://192.168.0.1">Speed Wi-Fi HOME 5G L13 / ZTR02</option>
                <option value="http://192.168.11.1">Buffalo</option>
                <option value="http://192.168.10.1">NEC Aterm</option>
                <option value="http://tplinkwifi.net">TP-Link</option>
            </select>
            <a id="router-link" href="#" target="_blank" class="btn" style="background:#555; color:white; display:none; text-decoration:none;">è¨­å®šç”»é¢ã‚’é–‹ã</a>
        </div>
    </div>
</div>

<div class="card" id="viewer-mode">
    <h2 id="view-name" style="text-align:center;">Shop Name</h2>
    <div class="wifi-box">
        <span class="material-icons-round">wifi</span>
        <div id="view-ssid">SSID: ---</div>
        <div id="view-pass" style="font-family:monospace; font-size:1.4rem; background:rgba(255,255,255,0.1); padding:10px; margin-top:10px; border-radius:8px; cursor:pointer;">PASSWORD</div>
        <div style="font-size:0.6rem; margin-top:5px; opacity:0.7;">ã‚¿ãƒƒãƒ—ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</div>
    </div>
    <div class="sns-grid">
        <a id="btn-line" href="#" target="_blank" class="sns-btn" style="background:#06C755; display:none;">LINE</a>
        <a id="btn-insta" href="#" target="_blank" class="sns-btn" style="background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#bc1888); display:none;">Insta</a>
        <a id="btn-hp" href="#" target="_blank" class="sns-btn" style="background:#FF3366; display:none;">äºˆç´„</a>
    </div>
    <a id="btn-map" href="#" target="_blank" class="btn btn-blue">
        <span class="material-icons-round">place</span> Googleãƒãƒƒãƒ—ã‚’é–‹ã
    </a>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDO9G5EdRX1U1H5dLPaFzOWGqjWx3qi9i0",
      authDomain: "onepage-jp.firebaseapp.com",
      projectId: "onepage-jp",
      storageBucket: "onepage-jp.firebasestorage.app",
      messagingSenderId: "417146750916",
      appId: "1:417146750916:web:c3901abeb2ee912b41c691"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            document.getElementById('my-uid').textContent = "ID: " + user.uid.substring(0,8);
            const snap = await getDoc(doc(db, "users", user.uid));
            if(snap.exists() && snap.data().plan === "pro") {
                document.getElementById('auth-section').innerHTML = "âœ¨ PRO ACTIVE";
                document.getElementById('auth-section').style.background = "#d4af37";
            }
        } else { signInAnonymously(auth); }
    });

    window.activateLicense = async function() {
        if(document.getElementById('license-input').value === "777") {
            await setDoc(doc(db, "users", auth.currentUser.uid), { plan: "pro" }, { merge: true });
            alert("Proèªè¨¼ã«æˆåŠŸã—ã¾ã—ãŸï¼");
            location.reload();
        } else { alert("ã‚­ãƒ¼ãŒé•ã„ã¾ã™"); }
    };

    window.updateRouterLink = function() {
        const val = document.getElementById('router-select').value;
        const link = document.getElementById('router-link');
        if(val) { link.href = val; link.style.display = 'flex'; }
        else { link.style.display = 'none'; }
    };

    window.startGeneration = async function() {
        const qRes = await fetch('https://qrng.anu.edu.au/API/jsonI.php?length=12&type=uint8');
        const qData = await qRes.json();
        const chars = "abcdefghijkmnpqrstuvwxyz23456789ABCDEFGHJKLMNPQRSTUVWXYZ";
        let pass = ""; qData.data.forEach(n => pass += chars[n % chars.length]);

        const p = new URLSearchParams();
        p.append('n', document.getElementById('in-name').value);
        p.append('a', document.getElementById('in-address').value);
        p.append('ig', document.getElementById('in-insta').value);
        p.append('l', document.getElementById('in-line').value);
        p.append('hp', document.getElementById('in-hp').value);
        p.append('s', document.getElementById('in-ssid').value);
        p.append('p', pass);

        const url = window.location.href.split('?')[0] + '?' + p.toString();
        document.getElementById("qrcode").innerHTML = "";
        new QRCode(document.getElementById("qrcode"), { text: url, width: 180, height: 180 });
        document.getElementById('result-area').style.display = 'block';
    };

    window.onload = function() {
        const p = new URLSearchParams(window.location.search);
        if(p.has('n')) {
            document.getElementById('creator-mode').style.display = 'none';
            document.getElementById('viewer-mode').style.display = 'block';
            document.getElementById('view-name').textContent = p.get('n');
            document.getElementById('view-ssid').textContent = "SSID: " + p.get('s');
            document.getElementById('view-pass').textContent = p.get('p');
            if(p.get('ig')) { document.getElementById('btn-insta').href=`https://instagram.com/${p.get('ig')}`; document.getElementById('btn-insta').style.display='block'; }
            if(p.get('l')) { document.getElementById('btn-line').href=`https://line.me/R/ti/p/${p.get('l')}`; document.getElementById('btn-line').style.display='block'; }
            if(p.get('hp')) { document.getElementById('btn-hp').href=p.get('hp'); document.getElementById('btn-hp').style.display='block'; }
            if(p.get('a')) { document.getElementById('btn-map').href=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.get('a'))}`; }
            document.getElementById('view-pass').onclick = () => { navigator.clipboard.writeText(p.get('p')); alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); };
        }
    };
</script>
</body>
</html>
