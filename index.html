<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>One Page | Shop & Wi-Fi Connector</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; background: #f0f2f5; color: #333; margin: 0; padding: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; background: white; padding: 30px; border-radius: 0 0 20px 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); box-sizing: border-box; }
        
        h1 { text-align: center; color: #2c3e50; margin: 10px 0 20px; font-size: 2.0rem; font-weight: 900; font-family: 'Arial Black', sans-serif; }
        .brand-sub { font-size: 0.8rem; color: #888; font-weight: normal; display: block; margin-top: 5px; }
        
        .btn-primary { width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; text-decoration: none; margin-top: 10px; }
        .btn-primary:disabled { background: #ccc; }

        .input-group { margin-bottom: 20px; position: relative; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.9rem; color: #555; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; background: #f9f9f9; }
        
        /* AIæ”¯æ´ãƒœã‚¿ãƒ³ */
        .ai-suggest-btn { position: absolute; right: 5px; top: 32px; background: #efecff; color: #764ba2; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 3px; border: 1px solid #dcd3ff; }

        /* PROã‚¨ãƒªã‚¢ */
        .pro-status-badge { background: #e8f5e9; color: #2e7d32; padding: 8px; border-radius: 8px; font-weight: bold; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .premium-feature { border: 2px solid #d4af37; padding: 15px; border-radius: 12px; margin-bottom: 15px; background: #fffdf5; position: relative; display: none; }
        .premium-badge-ui { position: absolute; top: -10px; right: 10px; background: #d4af37; color: white; font-size: 0.7rem; padding: 3px 10px; border-radius: 10px; font-weight: bold; }

        /* å®¢ç”¨ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸è¡¨ç¤º (Viewer) */
        #viewer-mode { display: none; width: 100%; max-width: 400px; padding: 20px; text-align: center; }
        .info-card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 4px solid #d4af37; overflow: hidden; padding-bottom: 30px; }
        .hero-image { width: 100%; height: 220px; object-fit: cover; background: #eee; }
        .shop-name-display { font-size: 1.8rem; font-weight: bold; margin: 20px 0; }
        .wifi-box-display { background: #2c3e50; color: white; margin: 0 20px; padding: 20px; border-radius: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div id="creator-mode" class="container">
    <h1>One Page <span class="brand-sub">Shop & Wi-Fi Connector</span></h1>

    <div id="pro-badge-area" style="display:none;">
        <div class="pro-status-badge"><span class="material-icons-round">check_circle</span> PROãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹ä¸­</div>
    </div>

    <div class="pro-auth-area" id="auth-box" style="background:#333; color:white; padding:15px; border-radius:12px; margin-bottom:20px; text-align:center;">
        <div style="font-size:0.8rem; margin-bottom:8px;">ğŸ” ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼</div>
        <input type="text" id="license-input" placeholder="777" style="width:50%; padding:8px; border-radius:4px; border:none; text-align:center;">
        <button onclick="activateLicense()" style="background:#d4af37; color:white; border:none; padding:8px 15px; border-radius:4px; font-weight:bold; cursor:pointer;">èªè¨¼</button>
    </div>

    <div class="input-group">
        <label>åº—èˆ—å</label>
        <input type="text" id="in-name" placeholder="ä¾‹ï¼šCafe One Page" oninput="suggestSSID()">
    </div>

    <div class="input-group">
        <label>SSID (Wi-Fiå)</label>
        <input type="text" id="in-ssid" placeholder="My-Shop-WiFi">
        <button class="ai-suggest-btn" id="ai-btn" onclick="applySSID()" style="display:none;">
            <span class="material-icons-round" style="font-size:14px;">psychology</span> ææ¡ˆ
        </button>
    </div>

    <div class="premium-feature" id="pro-feature-img">
        <div class="premium-badge-ui">PRO</div>
        <label>ğŸ“¸ åº—èˆ—ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
        <input type="file" id="in-file" accept="image/*" style="margin-top:10px;">
    </div>

    <button onclick="startGeneration()" class="btn-primary" id="btn-gen">
        <span class="material-icons-round">qr_code_2</span> ãƒšãƒ¼ã‚¸ä½œæˆé–‹å§‹
    </button>

    <div id="result-area" style="display:none; margin-top:30px; text-align:center;">
        <div id="qrcode-container" style="display:inline-block; padding:15px; background:white; border-radius:10px; border:1px solid #eee;"></div>
        <div style="margin-top:15px;">
            <a id="preview-link" href="#" target="_blank" style="color:#764ba2; font-weight:bold; text-decoration:none; display:flex; align-items:center; justify-content:center; gap:5px;">
                <span class="material-icons-round">visibility</span> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèªã™ã‚‹
            </a>
        </div>
    </div>
</div>

<div id="viewer-mode">
    <div class="info-card">
        <img id="view-img" class="hero-image" src="" style="display:none;">
        <div id="no-img-placeholder" style="height:60px; background:linear-gradient(to right, #d4af37, #f2d06b);"></div>
        <div class="shop-name-display" id="view-name">SHOP NAME</div>
        <div class="wifi-box-display" id="wifi-copy-btn">
            <span class="material-icons-round" style="font-size:48px;">wifi</span>
            <div id="view-ssid" style="font-size:1.2rem; font-weight:bold; margin-top:10px;">SSID: ---</div>
            <div id="view-pass" style="font-family:monospace; background:rgba(255,255,255,0.2); padding:10px; border-radius:8px; margin-top:10px; font-size:1.1rem;">---</div>
            <div style="font-size:0.7rem; margin-top:10px; opacity:0.8;">ã‚¿ãƒƒãƒ—ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</div>
        </div>
    </div>
    <p style="color:#888; font-size:0.7rem; margin-top:20px;">Powered by One Page</p>
</div>

<script type="module">
    let isPro = false;
    let suggestedName = "";

    // AIæ”¯æ´: SSIDææ¡ˆ
    window.suggestSSID = function() {
        const name = document.getElementById('in-name').value;
        const aiBtn = document.getElementById('ai-btn');
        if(name.length >= 2) {
            suggestedName = name.trim().replace(/\s+/g, '-') + "-Guest";
            aiBtn.style.display = 'flex';
        } else {
            aiBtn.style.display = 'none';
        }
    };

    window.applySSID = function() {
        document.getElementById('in-ssid').value = suggestedName;
        document.getElementById('ai-btn').style.display = 'none';
    };

    // èªè¨¼æ©Ÿèƒ½
    window.activateLicense = function() {
        const key = document.getElementById('license-input').value;
        if(key === "777") {
            isPro = true;
            document.getElementById('auth-box').style.display = 'none';
            document.getElementById('pro-badge-area').style.display = 'block';
            document.getElementById('pro-feature-img').style.display = 'block';
            alert("èªè¨¼æˆåŠŸï¼å…¨æ©Ÿèƒ½ãŒè§£æ”¾ã•ã‚Œã¾ã—ãŸã€‚");
        } else {
            alert("åˆè¨€è‘‰ãŒé•ã„ã¾ã™");
        }
    };

    // ãƒšãƒ¼ã‚¸ä½œæˆ (é‡å­ã‚­ãƒ¼å«ã‚€)
    window.startGeneration = async function() {
        const btn = document.getElementById('btn-gen');
        btn.disabled = true;
        btn.textContent = "é‡å­ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆä¸­...";

        let pass = "";
        try {
            const res = await fetch('https://qrng.anu.edu.au/API/jsonI.php?length=1&type=uint8', { signal: AbortSignal.timeout(3000) });
            const data = await res.json();
            const qNum = data.data[0];
            pass = Math.random().toString(36).slice(-4).toUpperCase() + qNum + Math.random().toString(36).slice(-4).toUpperCase();
        } catch (e) {
            // é‡å­ã‚µãƒ¼ãƒãƒ¼ãŒã‚¨ãƒ©ãƒ¼ã®æ™‚ã¯å³åº§ã«è‡ªå‰ç”Ÿæˆã«åˆ‡ã‚Šæ›¿ãˆï¼ˆèµ¤æ–‡å­—ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã•ãªã„ï¼‰
            pass = "Q-" + Math.random().toString(36).slice(-10).toUpperCase();
        }

        const name = document.getElementById('in-name').value || "Shop";
        const ssid = document.getElementById('in-ssid').value || "WiFi";
        
        const params = new URLSearchParams();
        params.append('n', name);
        params.append('s', ssid);
        params.append('p', pass);

        const baseUrl = window.location.href.split('?')[0];
        const finalUrl = `${baseUrl}?${params.toString()}`;
        
        document.getElementById('qrcode-container').innerHTML = "";
        new QRCode(document.getElementById("qrcode-container"), {
            text: finalUrl, width: 200, height: 200, colorDark: "#2c3e50"
        });

        document.getElementById('preview-link').href = finalUrl;
        document.getElementById('result-area').style.display = 'block';
        
        btn.disabled = false;
        btn.textContent = "ãƒšãƒ¼ã‚¸ä½œæˆå®Œäº†ï¼";
    };

    // åˆæœŸèµ·å‹•æ™‚ã®å‡¦ç†ï¼ˆå®¢ç”¨è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆï¼‰
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        if(params.has('n')) {
            document.getElementById('creator-mode').style.display = 'none';
            document.getElementById('viewer-mode').style.display = 'block';
            
            const name = params.get('n');
            const ssid = params.get('s');
            const pass = params.get('p');

            document.getElementById('view-name').textContent = name;
            document.getElementById('view-ssid').textContent = "SSID: " + ssid;
            document.getElementById('view-pass').textContent = pass;
            
            document.getElementById('wifi-copy-btn').onclick = function() {
                navigator.clipboard.writeText(pass);
                alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            };
        }
    };
</script>
</body>
</html>
